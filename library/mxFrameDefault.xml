<mxFrame>
	<mxFramePublic>
	</mxFramePublic>
	<!--API Result Display-->
	<APIResultDisplay>
		<css>
			.APIResultDisplay{
				font-family: Arial,微软雅黑;
				border: 1px #999 solid;
				border-radius: 3px;
				display: block;
				background: #EEE;
				box-shadow: 0px 1px 1px #AAA;
				padding: 1em;
			}
		</css>
		<template>
			<![CDATA[
				<div mx name = "inputPanel"></div>
				<div mx name = "resultDisplayTable"></div>
			]]>
		</template>
		<inputPanel>
			<css>
			.inputPanel{
				background: #FDFDFD;
				border: 1px #999 solid;
				display: block;
				border-radius: 3px;
				padding: 1em;
			}
			.inputPanel p{
				display: block;
				padding: 0;
				margin: 0;
			}
			.inputPanel label{
				font-size: 1.2em;
				display: inline-block;
				line-height: 2.25em;
				min-width: 12em;
			}
			.inputPanel input{
				font-size: 1.05em;
				display: inline-block;
				height: 1.75em;
				line-height: 1.1em;
				width: 25em;
				border-radius: 3px;
				outline: none;
				border: 1px #999 solid;
				background: #FEFEFE;
			}
			.inputPanel select{
				font-size: 1.05em;
				display: inline-block;
				height: 1.75em;
				line-height: 1.1em;
				width: 15em;
				border-radius: 3px;
				outline: none;
				border: 1px #999 solid;
				background: #FEFEFE;
			}
			.inputPanel button{
				font-size: 1.05em;
				display: inline-block;
				height: 1.75em;
				line-height: 1.1em;
				min-width: 5em;
				border-radius: 3px;
				outline: none;
				border: 1px #999 solid;
				background: #FEFEFE;
			}
			.inputPanel button:hover{
				background: #EEE;
			}
			</css>
			<template>
				<![CDATA[
					<form>
						<p><label>API URL:</label><input type = "text" name = "apiurl" placeholder = "input API url in here"/></p>
						<p><label>DATA POSITION:</label><input type = "text" name = "dataposition" placeholder = "input where the main data part is in api result"/></p>
						<p><label>REQUEST METHOD:</label><SELECT name = "method"><OPTION value = "GET">GET</OPTION><OPTION value = "POST">POST</OPTION></SELECT></p>
						<p><label>DATA:</label><input type = "text" name = "data" placeholder = "input data object in here"/></p>
						<p><button>Submit</button></p>
					</form>
				]]>
			</template>
			<eventHooks>
				<![CDATA[
				{
					inputSubmit: {
						target: 'form',
						event: 'submit',
						do: function(event){
							var displayTable = $thisItem.parentNode.querySelector('[name="resultDisplayTable"]'),
								dataUrl = $thisItem.querySelector('[name="apiurl"]').value,
								dataPosition = $thisItem.querySelector('[name="dataposition"]').value,
								method = $thisItem.querySelector('[name="method"]').value;
								dataInput = $thisItem.querySelector('[name="data"]').value;
							if (dataUrl){
								displayTable.setAttribute('data-url',dataUrl);
								displayTable.setAttribute('data','{url:"' + dataUrl + '"}');
								displayTable.setAttribute('data-position',dataPosition);
								displayTable.setAttribute('data-method',method);
								displayTable.setAttribute('data-input',dataInput);
								displayTable.data.buttonElement = $thisItem.querySelector('button');
								$thisItem.querySelector('button').setAttribute('disabled','true');
								$mx.frame.render(displayTable);
							}
							event.preventDefault();
						}
					},
				}
				]]>
			</eventHooks>
		</inputPanel>
		<resultDisplayTable>
			<data>
				{
					url: 'NO DATA',
				}
			</data>
			<css>
				.resultDisplayTable{
					width: 100%;
					overflow-x: auto;
				}
				.resultDisplayTable table{
					width: 100%;
					border:1px #999 solid;
					border-radius: 3px;
				}
				.resultDisplayTable thead{
					font-size: 1.1em;
					font-weight: bold;
					background: #CCC;
					line-height: 2em;
					text-align: center;
				}
				.resultDisplayTable tfoot{
					font-size: 0.8em;
					line-height: 1.5em;
					background: #DDD;
					text-align: center;
					color: #AAA;
				}
				.resultDisplayTable table tbody .title{
					background: #DDD;
					font-weight: bold;
					text-align: center;
				}
				.resultDisplayTable table tbody .line td{
					border-bottom: 1px #CCC solid;
				}
			</css>
			<template>
				<![CDATA[
					<table>
						<thead>
							<tr><td>{{url}}</td></tr>
						</thead>
						<tfoot>
							<tr><td>mxFrame API Loader</td></tr>
						</tfoot>
						<tbody>
						</tbody>						
					</table>
				]]>
			</template>
			<callback>
				<![CDATA[
					console.log($data);
					if ($data.api){
						var tableBody = $this.querySelector('tbody'),
							data = $data.api,
                            html = '<tr>',
                            colsCount = 0;
                        for (var col in data[0]){
                            html += '<td class = "title">' + col + '</td>';
                            colsCount++;
                        }
                        html += '</tr>';
                        for (var line in data){
                            html += '<tr class = "line">';
                            for (var col in data[line]){
                                html += '<td>' + data[line][col] + '</td>';
                            }
                        	html += '</tr>';
                        }
                        $this.querySelector('thead').getElementsByTagName('td')[0].setAttribute('colspan',colsCount++);
                        $this.querySelector('tfoot').getElementsByTagName('td')[0].setAttribute('colspan',colsCount++);
                        tableBody.innerHTML = html;
                        $data.buttonElement.removeAttribute('disabled');
					}
				]]>
			</callback>
		</resultDisplayTable>	
	</APIResultDisplay>		
	<!--API Result Display-->
</mxFrame>